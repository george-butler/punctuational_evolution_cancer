library(MCMCglmm)
mod<-readRDS("~/Desktop/petos_paradox_data_and_results/results/longevity_results/bm_single_slope_single_log_prop_life_expectancy_expectancy_df.rds")
summary(mod)
library(MCMCglmm)
mode<-readRDS("~/Desktop/petos_paradox_data_and_results/results/longevity_results/bm_single_slope_longevity.rds")
summary(mode)
mode<-readRDS("~/Desktop/petos_paradox_data_and_results/results/longevity_results/bm_single_slope_prop_expectancy_df.rds")
summary(mode)
library(ape)
library(pbmcapply)
resolve_polytomies<-function(t){
return(di2multi(t,0.000001))
}
rm(list = setdiff(ls(), lsf.str()))
myargs = commandArgs(trailingOnly=TRUE)
id<- myargs[1]
id<-74
dir.create("./ml_trees", showWarnings = FALSE)
dir.create("./ml_trees_combined", showWarnings = FALSE)
setwd(".")
setwd("~/Documents/GitHub/punc_evo_cancer/measure_path_length_and_node_count")
setwd("~/Documents/GitHub/punc_evo_cancer/node_density_artifact")
library(ape)
library(pbmcapply)
resolve_polytomies<-function(t){
return(di2multi(t,0.000001))
}
rm(list = setdiff(ls(), lsf.str()))
myargs = commandArgs(trailingOnly=TRUE)
id<- myargs[1]
id<-74
dir.create("./ml_trees", showWarnings = FALSE)
dir.create("./ml_trees_combined", showWarnings = FALSE)
node_pl_file<-read.delim(paste0("./path_length_vs_no_nodes_lineagegrp_",id,".txt"))
no_root_tree_file<-read.nexus(paste0("./no_root_l1000_lineagegrp_",id,".nexus.trees"))
resolved_tree<-lapply(no_root_tree_file,resolve_polytomies)
t_ids<-unique(node_pl_file$.id)
for ( i in 1:length(t_ids)){
target_tree_id<-t_ids[i]
target_tree<-resolved_tree[target_tree_id][[1]]
target_data<-node_pl_file[node_pl_file$.id == target_tree_id,]
target_data<-subset(target_data, select = -c(.id))
dir.create(paste0("./ml_trees/tree_",i), showWarnings = FALSE)
dummy_node_pl_file<-paste0("./ml_trees/tree_",i,"/no_nodes_lineagegrp_",id,".txt")
single_tree_file<-paste0("./ml_trees/tree_",i,"/no_root_tree",i,".nexus.trees")
write.nexus(target_tree,file=single_tree_file)
tmp_df<-target_data[c("cell_id","path_length","no_nodes","tumor_id")]
dummy_pl_file<-tmp_df[,c("cell_id","no_nodes")]
write.table(noquote(dummy_pl_file),dummy_node_pl_file,row.names = FALSE,sep="\t",quote = FALSE)
}
parallel_imp<-function(i){
dummy_node_pl_file<-paste0("./ml_trees/tree_",i,"/no_nodes_lineagegrp_",id,".txt")
single_tree_file<-paste0("./ml_trees/tree_",i,"/no_root_tree",i,".nexus.trees")
system(paste0("OMP_NUM_THREADS=1 ./BayesTraitsV4 ", single_tree_file," ",dummy_node_pl_file, " < ./delta_test_BT_run_file.txt.txt > /dev/null"))
data_start_line<-system(paste0("echo $(cat ./ml_trees/tree_",i,"/*Log.txt | grep -n Lh | cut -d : -f 1)"), intern = TRUE)
system(paste0("tail -n +",data_start_line," ./ml_trees/tree_",i,"/*Log.txt > ./ml_trees/tree_",i,"/dataframe_tree_",i,"_no_nodes_lineagegrp_",id,".txt"))
system(paste0("mv ./ml_trees/tree_",i,"/dataframe_tree_",i,"_no_nodes_lineagegrp_",id,".txt ./ml_trees_combined"))
return(i)
}
no_cores<-10
opt<-pbmclapply(1:length(t_ids),parallel_imp,mc.cores=no_cores,ignore.interactive = T)
parallel_imp<-function(i){
dummy_node_pl_file<-paste0("./ml_trees/tree_",i,"/no_nodes_lineagegrp_",id,".txt")
single_tree_file<-paste0("./ml_trees/tree_",i,"/no_root_tree",i,".nexus.trees")
system(paste0("OMP_NUM_THREADS=1 ./BayesTraitsV4 ", single_tree_file," ",dummy_node_pl_file, " < ./delta_test_BT_run_file.txt.txt > /dev/null"))
data_start_line<-system(paste0("echo $(cat ./ml_trees/tree_",i,"/*Log.txt | grep -n Lh | cut -d : -f 1)"), intern = TRUE)
system(paste0("tail -n +",data_start_line," ./ml_trees/tree_",i,"/*Log.txt > ./ml_trees/tree_",i,"/dataframe_tree_",i,"_no_nodes_lineagegrp_",id,".txt"))
system(paste0("mv ./ml_trees/tree_",i,"/dataframe_tree_",i,"_no_nodes_lineagegrp_",id,".txt ./ml_trees_combined"))
return(i)
}
no_cores<-10
opt<-pbmclapply(1:length(t_ids),parallel_imp,mc.cores=no_cores,ignore.interactive = T)
parallel_imp(1)
parallel_imp<-function(i){
dummy_node_pl_file<-paste0("./ml_trees/tree_",i,"/no_nodes_lineagegrp_",id,".txt")
single_tree_file<-paste0("./ml_trees/tree_",i,"/no_root_tree",i,".nexus.trees")
system(paste0("OMP_NUM_THREADS=1 ./BayesTraitsV4 ", single_tree_file," ",dummy_node_pl_file, " < ./delta_test_BT_run_file.txt.txt > /dev/null"))
data_start_line<-system(paste0("echo $(cat ./ml_trees/tree_",i,"/*Log.txt | grep -n Lh | cut -d : -f 1)"), intern = TRUE)
system(paste0("tail -n +",data_start_line," ./ml_trees/tree_",i,"/*Log.txt > ./ml_trees/tree_",i,"/dataframe_tree_",i,"_no_nodes_lineagegrp_",id,".txt"))
system(paste0("mv ./ml_trees/tree_",i,"/dataframe_tree_",i,"_no_nodes_lineagegrp_",id,".txt ./ml_trees_combined"))
return(i)
}
no_cores<-10
parallel_imp(1)
parallel_imp<-function(i){
dummy_node_pl_file<-paste0("./ml_trees/tree_",i,"/no_nodes_lineagegrp_",id,".txt")
single_tree_file<-paste0("./ml_trees/tree_",i,"/no_root_tree",i,".nexus.trees")
system(paste0("OMP_NUM_THREADS=1 ./BayesTraitsV4 ", single_tree_file," ",dummy_node_pl_file, " < ./delta_test_BT_run_file.txt > /dev/null"))
data_start_line<-system(paste0("echo $(cat ./ml_trees/tree_",i,"/*Log.txt | grep -n Lh | cut -d : -f 1)"), intern = TRUE)
system(paste0("tail -n +",data_start_line," ./ml_trees/tree_",i,"/*Log.txt > ./ml_trees/tree_",i,"/dataframe_tree_",i,"_no_nodes_lineagegrp_",id,".txt"))
system(paste0("mv ./ml_trees/tree_",i,"/dataframe_tree_",i,"_no_nodes_lineagegrp_",id,".txt ./ml_trees_combined"))
return(i)
}
no_cores<-10
parallel_imp(1)
library(ape)
library(pbmcapply)
resolve_polytomies<-function(t){
return(di2multi(t,0.000001))
}
rm(list = setdiff(ls(), lsf.str()))
myargs = commandArgs(trailingOnly=TRUE)
id<- myargs[1]
id<-74
dir.create("./ml_trees", showWarnings = FALSE)
dir.create("./ml_trees_combined", showWarnings = FALSE)
node_pl_file<-read.delim(paste0("./path_length_vs_no_nodes_lineagegrp_",id,".txt"))
no_root_tree_file<-read.nexus(paste0("./no_root_l1000_lineagegrp_",id,".nexus.trees"))
resolved_tree<-lapply(no_root_tree_file,resolve_polytomies)
t_ids<-unique(node_pl_file$.id)
for ( i in 1:length(t_ids)){
target_tree_id<-t_ids[i]
target_tree<-resolved_tree[target_tree_id][[1]]
target_data<-node_pl_file[node_pl_file$.id == target_tree_id,]
target_data<-subset(target_data, select = -c(.id))
dir.create(paste0("./ml_trees/tree_",i), showWarnings = FALSE)
dummy_node_pl_file<-paste0("./ml_trees/tree_",i,"/no_nodes_lineagegrp_",id,".txt")
single_tree_file<-paste0("./ml_trees/tree_",i,"/no_root_tree",i,".nexus.trees")
write.nexus(target_tree,file=single_tree_file)
tmp_df<-target_data[c("cell_id","path_length","no_nodes","tumor_id")]
dummy_pl_file<-tmp_df[,c("cell_id","no_nodes")]
write.table(noquote(dummy_pl_file),dummy_node_pl_file,row.names = FALSE,sep="\t",quote = FALSE)
}
parallel_imp<-function(i){
dummy_node_pl_file<-paste0("./ml_trees/tree_",i,"/no_nodes_lineagegrp_",id,".txt")
single_tree_file<-paste0("./ml_trees/tree_",i,"/no_root_tree",i,".nexus.trees")
system(paste0("OMP_NUM_THREADS=1 ./BayesTraitsV4 ", single_tree_file," ",dummy_node_pl_file, " < ./delta_test_BT_run_file.txt > /dev/null"))
data_start_line<-system(paste0("echo $(cat ./ml_trees/tree_",i,"/*Log.txt | grep -n Lh | cut -d : -f 1)"), intern = TRUE)
system(paste0("tail -n +",data_start_line," ./ml_trees/tree_",i,"/*Log.txt > ./ml_trees/tree_",i,"/dataframe_tree_",i,"_no_nodes_lineagegrp_",id,".txt"))
system(paste0("mv ./ml_trees/tree_",i,"/dataframe_tree_",i,"_no_nodes_lineagegrp_",id,".txt ./ml_trees_combined"))
return(i)
}
no_cores<-10
opt<-pbmclapply(1:length(t_ids),parallel_imp,mc.cores=no_cores,ignore.interactive = T)
system(paste0("nawk 'FNR==1 && NR!=1{next;}{print}' ./ml_trees_combined/*.txt > ./ml_trees_combined/combined_no_nodes_lineagegrp_",id,".txt"))
system("rm ./ml_trees_combined/dataframe*.txt")
setwd("~/Documents/GitHub/punc_evo_cancer/punctuational_evolution")
library(ape)
library(pbmcapply)
resolve_polytomies<-function(t){
return(di2multi(t,0.000001))
}
dummy_code_single_met_intercet_and_slope<-function(df){
df<-df[c("cell_id","path_length","no_nodes","tumor_id")]
df$intercept_single<-1
df[grep("T",df$tumor_id),]$intercept_single<-0
df$slope_single<-1
df[grep("T",df$tumor_id),]$slope_single<-0
df$slope_single<-df$slope_single*df[,3]
df<-subset(df,select=-c(tumor_id))
return(df)
}
rm(list = setdiff(ls(), lsf.str()))
myargs = commandArgs(trailingOnly=TRUE)
id<- myargs[1]
model_type<-myargs[2]
id<-12
model_type<-0
print(c(id,model_type))
if (model_type == 0){
setwd(paste0("./tumor_only_regressions/"))
}
library(ape)
library(pbmcapply)
resolve_polytomies<-function(t){
return(di2multi(t,0.000001))
}
dummy_code_single_met_intercet_and_slope<-function(df){
df<-df[c("cell_id","path_length","no_nodes","tumor_id")]
df$intercept_single<-1
df[grep("T",df$tumor_id),]$intercept_single<-0
df$slope_single<-1
df[grep("T",df$tumor_id),]$slope_single<-0
df$slope_single<-df$slope_single*df[,3]
df<-subset(df,select=-c(tumor_id))
return(df)
}
rm(list = setdiff(ls(), lsf.str()))
myargs = commandArgs(trailingOnly=TRUE)
id<- myargs[1]
model_type<-myargs[2]
id<-12
model_type<-0
print(c(id,model_type))
if (model_type == 0){
setwd(paste0("./tumor_only_regressions"))
}
if (model_type == 0){
setwd(paste0("./tumor_only_regression"))
}
if (model_type == 1){
setwd(paste0("./single_met_intercept_and_slope"))
}
system("rm -r *")
dir.create("./ml_trees", showWarnings = FALSE)
dir.create("./ml_trees_combined", showWarnings = FALSE)
library(ape)
library(pbmcapply)
resolve_polytomies<-function(t){
return(di2multi(t,0.000001))
}
dummy_code_single_met_intercet_and_slope<-function(df){
df<-df[c("cell_id","path_length","no_nodes","tumor_id")]
df$intercept_single<-1
df[grep("T",df$tumor_id),]$intercept_single<-0
df$slope_single<-1
df[grep("T",df$tumor_id),]$slope_single<-0
df$slope_single<-df$slope_single*df[,3]
df<-subset(df,select=-c(tumor_id))
return(df)
}
rm(list = setdiff(ls(), lsf.str()))
myargs = commandArgs(trailingOnly=TRUE)
id<- myargs[1]
model_type<-myargs[2]
id<-74
model_type<-0
system("rm -r *")
dir.create("./ml_trees", showWarnings = FALSE)
dir.create("./ml_trees_combined", showWarnings = FALSE)
node_pl_file<-read.delim(paste0("~/path_length_vs_no_nodes_lineagegrp_",id,".txt"))
setwd("~/Documents/GitHub/punc_evo_cancer/punctuational_evolution")
library(ape)
library(pbmcapply)
resolve_polytomies<-function(t){
return(di2multi(t,0.000001))
}
rm(list = setdiff(ls(), lsf.str()))
myargs = commandArgs(trailingOnly=TRUE)
id<- myargs[1]
model_type<-myargs[2]
id<-74
system("rm -r *")
library(ape)
library(pbmcapply)
resolve_polytomies<-function(t){
return(di2multi(t,0.000001))
}
rm(list = setdiff(ls(), lsf.str()))
myargs = commandArgs(trailingOnly=TRUE)
id<- myargs[1]
model_type<-myargs[2]
id<-74
dir.create("./ml_trees", showWarnings = FALSE)
dir.create("./ml_trees_combined", showWarnings = FALSE)
node_pl_file<-read.delim(paste0("~/path_length_vs_no_nodes_lineagegrp_",id,".txt"))
node_pl_file<-read.delim(paste0("./path_length_vs_no_nodes_lineagegrp_",id,".txt"))
no_root_tree_file<-read.nexus(paste0("./no_root_l1000_lineagegrp_",id,".nexus.trees"))
resolved_tree<-lapply(no_root_tree_file,resolve_polytomies)
t_ids<-unique(node_pl_file$.id)
for ( i in 1:length(t_ids)){
target_tree_id<-t_ids[i]
target_tree<-resolved_tree[target_tree_id][[1]]
target_data<-node_pl_file[node_pl_file$.id == target_tree_id,]
target_data<-subset(target_data, select = -c(.id))
dir.create(paste0("./ml_trees/tree_",i), showWarnings = FALSE)
dummy_node_pl_file<-paste0("./ml_trees/tree_",i,"/path_length_vs_no_nodes_lineagegrp_",id,".txt")
single_tree_file<-paste0("./ml_trees/tree_",i,"/no_root_tree",i,".nexus.trees")
write.nexus(target_tree,file=single_tree_file)
tmp_df<-target_data[c("cell_id","path_length","no_nodes","tumor_id")]
dummy_pl_file<-tmp_df[,-c(ncol(tmp_df))]
write.table(noquote(dummy_pl_file),dummy_node_pl_file,row.names = FALSE,sep="\t",quote = FALSE)
}
parallel_imp<-function(i){
dummy_node_pl_file<-paste0("./ml_trees/tree_",i,"/path_length_vs_no_nodes_lineagegrp_",id,".txt")
single_tree_file<-paste0("./ml_trees/tree_",i,"/no_root_tree",i,".nexus.trees")
system(paste0("OMP_NUM_THREADS=1 ./BayesTraitsV4 ", single_tree_file," ",dummy_node_pl_file, " < ~/regression_BT_run_file.txt > /dev/null"))
data_start_line<-system(paste0("echo $(cat ./ml_trees/tree_",i,"/*Log.txt | grep -n Lh | cut -d : -f 1)"), intern = TRUE)
system(paste0("tail -n +",data_start_line," ./ml_trees/tree_",i,"/*Log.txt > ./ml_trees/tree_",i,"/dataframe_tree_",i,"_path_length_vs_no_nodes_lineagegrp_",id,".txt"))
system(paste0("mv ./ml_trees/tree_",i,"/dataframe_tree_",i,"_path_length_vs_no_nodes_lineagegrp_",id,".txt ./ml_trees_combined"))
df<-read.delim(paste0("./ml_trees_combined/dataframe_tree_",i,"_path_length_vs_no_nodes_lineagegrp_",id,".txt"))
df$tree_num<-i
write.table(noquote(df),paste0("./ml_trees_combined/dataframe_tree_",i,"_path_length_vs_no_nodes_lineagegrp_",id,".txt"),row.names = FALSE,sep="\t",quote = FALSE)
return(i)
}
no_cores<-40
opt<-pbmclapply(1:length(t_ids),parallel_imp,mc.cores=no_cores,ignore.interactive = T)
parallel_imp(1)
parallel_imp<-function(i){
dummy_node_pl_file<-paste0("./ml_trees/tree_",i,"/path_length_vs_no_nodes_lineagegrp_",id,".txt")
single_tree_file<-paste0("./ml_trees/tree_",i,"/no_root_tree",i,".nexus.trees")
system(paste0("OMP_NUM_THREADS=1 ./BayesTraitsV4 ", single_tree_file," ",dummy_node_pl_file, " < ./regression_BT_run_file.txt > /dev/null"))
data_start_line<-system(paste0("echo $(cat ./ml_trees/tree_",i,"/*Log.txt | grep -n Lh | cut -d : -f 1)"), intern = TRUE)
system(paste0("tail -n +",data_start_line," ./ml_trees/tree_",i,"/*Log.txt > ./ml_trees/tree_",i,"/dataframe_tree_",i,"_path_length_vs_no_nodes_lineagegrp_",id,".txt"))
system(paste0("mv ./ml_trees/tree_",i,"/dataframe_tree_",i,"_path_length_vs_no_nodes_lineagegrp_",id,".txt ./ml_trees_combined"))
df<-read.delim(paste0("./ml_trees_combined/dataframe_tree_",i,"_path_length_vs_no_nodes_lineagegrp_",id,".txt"))
df$tree_num<-i
write.table(noquote(df),paste0("./ml_trees_combined/dataframe_tree_",i,"_path_length_vs_no_nodes_lineagegrp_",id,".txt"),row.names = FALSE,sep="\t",quote = FALSE)
return(i)
}
parallel_imp(1)
parallel_imp<-function(i){
dummy_node_pl_file<-paste0("./ml_trees/tree_",i,"/path_length_vs_no_nodes_lineagegrp_",id,".txt")
single_tree_file<-paste0("./ml_trees/tree_",i,"/no_root_tree",i,".nexus.trees")
system(paste0("OMP_NUM_THREADS=1 ./BayesTraitsV4 ", single_tree_file," ",dummy_node_pl_file, " < ./regression_BT_run_file.txt > /dev/null"))
data_start_line<-system(paste0("echo $(cat ./ml_trees/tree_",i,"/*Log.txt | grep -n Lh | cut -d : -f 1)"), intern = TRUE)
system(paste0("tail -n +",data_start_line," ./ml_trees/tree_",i,"/*Log.txt > ./ml_trees/tree_",i,"/dataframe_tree_",i,"_path_length_vs_no_nodes_lineagegrp_",id,".txt"))
system(paste0("mv ./ml_trees/tree_",i,"/dataframe_tree_",i,"_path_length_vs_no_nodes_lineagegrp_",id,".txt ./ml_trees_combined"))
df<-read.delim(paste0("./ml_trees_combined/dataframe_tree_",i,"_path_length_vs_no_nodes_lineagegrp_",id,".txt"))
df$tree_num<-i
write.table(noquote(df),paste0("./ml_trees_combined/dataframe_tree_",i,"_path_length_vs_no_nodes_lineagegrp_",id,".txt"),row.names = FALSE,sep="\t",quote = FALSE)
return(i)
}
parallel_imp(1)
parallel_imp<-function(i){
dummy_node_pl_file<-paste0("./ml_trees/tree_",i,"/path_length_vs_no_nodes_lineagegrp_",id,".txt")
single_tree_file<-paste0("./ml_trees/tree_",i,"/no_root_tree",i,".nexus.trees")
system(paste0("OMP_NUM_THREADS=1 ./BayesTraitsV4 ", single_tree_file," ",dummy_node_pl_file, " < ./regression_BT_run_file.txt > /dev/null"))
data_start_line<-system(paste0("echo $(cat ./ml_trees/tree_",i,"/*Log.txt | grep -n Lh | cut -d : -f 1)"), intern = TRUE)
system(paste0("tail -n +",data_start_line," ./ml_trees/tree_",i,"/*Log.txt > ./ml_trees/tree_",i,"/dataframe_tree_",i,"_path_length_vs_no_nodes_lineagegrp_",id,".txt"))
system(paste0("mv ./ml_trees/tree_",i,"/dataframe_tree_",i,"_path_length_vs_no_nodes_lineagegrp_",id,".txt ./ml_trees_combined"))
df<-read.delim(paste0("./ml_trees_combined/dataframe_tree_",i,"_path_length_vs_no_nodes_lineagegrp_",id,".txt"))
df$tree_num<-i
write.table(noquote(df),paste0("./ml_trees_combined/dataframe_tree_",i,"_path_length_vs_no_nodes_lineagegrp_",id,".txt"),row.names = FALSE,sep="\t",quote = FALSE)
return(i)
}
no_cores<-40
opt<-pbmclapply(1:length(t_ids),parallel_imp,mc.cores=no_cores,ignore.interactive = T)
system(paste0("nawk 'FNR==1 && NR!=1{next;}{print}' ./ml_trees_combined/*.txt > ./ml_trees_combined/combined_path_length_vs_no_nodes_lineagegrp_",id,".txt"))
system("rm ./ml_trees_combined/dataframe*.txt")
